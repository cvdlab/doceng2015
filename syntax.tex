
\section{HIJSON structure and syntax}\label{hijson-syntax}

In listing~\ref{lst:hijson-example} it is shown a simplified HIJSON document, devoid of puctual datails, to make clear to the reader the defined structure.

\begin{lstlisting}[language=json, label={lst:hijson-example}, captionpos=b, caption=Example of HIJSON document.]
{
  "config": {
    // ...
  },
  "data": [
    ...
    {
      "id": "architecture",
      "type": "FeatureCollection",
      "features": [
        // ...
      ] 
    },
    {
      "id": "furniture_1",
      "type": "FeatureCollection",
      "features": [
        // ...
      ] 
    },
    // ...
  ]
}
\end{lstlisting}


The HIJSON document is composed of a configuration section, followed by one or more {\tt DataCollections}, containing the actual data.

The configuration includes parameters and settings needed for building representation in the form of a JSON Object. One of the core information in this section is defined by the correspondence between three points of the local coordinate system and three point of the real world, expressed in geographical coordinates. This is needed to ensure a seamlessly passage from local to geographical coordinate system and vice versa.

After the configuration part, goes a {\tt DataCollection} list. Each element of the list is given in the form of a GeoJSON {\tt FeatureCollection}, containing an arbitrary 
number of {\emph HIJSON Elements}. Since  HIJSON Elements adhere to the GeoJSON
format, each DataCollection results compliant with GeoJSON syntax and then accepted by any GeoJSON validator. An example of {\tt DataCollection} is given in listing~\ref{lst:data-collection-example}. HIJSON format introduces some additional rules that allow the adoption of this
format for indoor representation, detailed below.

\begin{lstlisting}[language=json, label={lst:data-collection-example}, captionpos=b, caption=Example of data collection, with the definition of a HIJSON Element.]
{
  "id": "architecture",
  "type": "FeatureCollection",
  "features": [
    // ...
    {
      "type": "Feature",
      "id": "room_0.1",
      "geometry": {
        "type": "Polygon",
        "coordinates": [ 
          [ [0, 0], [11, 0], [11, 19], [0, 19] ]
        ]
    },
    "properties": {
      "class": "room",
      "parent": "level_0",
      "description": "Office of Mr. Smith",
      "tVector": [10, 20, 0],
      "rVector": [0, 0, 90]
    },
    // ...
  ]
}
\end{lstlisting}

\subsection{HIJSON Element}

An HIJSON Element describes an architectural ...

The first additional requisite above the GeoJSON format rules is the
necessity of a unique ID, necessary for the referencing by possible
child elements. The Geometry types allowed are \texttt{Point},
\texttt{LineString} and \texttt{Polygon}. Each geometry type is used to
represent particular categories of elements (e.g.~Polygons for levels
and rooms, LineString for walls and doors, Point for furniture, etc.).
The geometry coordinates are expressed in meters, and for convention
starting at the bottom-left of the element. Unlike GeoJSON, where all
the properties are optional, in HIJSON some attributes are mandatories:

\begin{itemize}
\itemsep1pt\parskip0pt\parsep0pt
\item
 \texttt{class}: represent the element category, used to instantiate
 the appropriate semantic class;
\item
 \texttt{parent}: contains parent's id of the nodes. The reason of the
 unique id depends on this property. The HIJSON Tree is created on the
 base of parent property;
\item
 \texttt{tVector} and \texttt{rVector}: represent the translation and
 rotation relative to the parent element. The measure unit for
 translation is meter and for rotation is grades.
\end{itemize}

The definition of other properties is mandatory depending on the class
of the element: For example the classes that defines internal or
external walls require a \texttt{connections} array, containing the IDs
of the adiacent areas. This information is used by the connector
children of the element, like doors, to identify the areas linked
together. These connector elements are identified by a
boolean \texttt{connector} property.

Optional fields can be added to improve the precision of the
representation. Given the nature of the GeoJSON format from which HIJSON
derives, the elements are represented by their 2D shape, like on a
planimetry. To assign a value to the height of the object, intended as
third dimension, the property \texttt{height} can be used.

A \texttt{description} property can provide further information about
the element.

Additional optional fields can be added without restrictions, in order  to
enrich and extend the expressvity of the representation.
